<!DOCTYPE html>
<!--
  Copyright 2010 Google Inc.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

  Original slides: Marcin Wichary (mwichary@google.com)
  Modifications: Ernest Delgado (ernestd@google.com)
                 Alex Russell (slightlyoff@chromium.org)

  landslide modifications: Adam Zapletal (adamzap@gmail.com)
                           Nicolas Perriault (nperriault@gmail.com)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>大数据算命系列（1）</title>
    <!-- Styles -->
    
    <link rel="stylesheet" media="print" href="file:///usr/local/lib/python2.7/dist-packages/landslide/themes/default/css/print.css">
    <link rel="stylesheet" media="screen, projection" href="file:///usr/local/lib/python2.7/dist-packages/landslide/themes/tango/css/screen.css">
    
    
    <!-- /Styles -->
    <!-- Javascripts -->
    
    <script type="text/javascript" src="file:///usr/local/lib/python2.7/dist-packages/landslide/themes/default/js/slides.js"></script>
    
    
    <!-- /Javascripts -->
</head>
<body>
  <div id="blank"></div>
  <div class="presentation">
    <div id="current_presenter_notes">
      <div id="presenter_note"></div>
    </div>
    <div class="slides">
      
      <!-- slide source: naive_bayes.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>大数据算命系列（1）</h1></header>
            
            
            <section><h2>朴素贝叶斯算法简介与应用</h2>
<blockquote>
<p>-----  大数据算命师</p>
<p>-----  2013.06.06(更新:2013.12.13)</p>
</blockquote></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="naive_bayes.rst">naive_bayes.rst</a>
            </aside>
            
            <aside class="page_number">
              1/12
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: naive_bayes.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>贝叶斯公式</h1></header>
            
            
            <section><ul class="simple">
<li>贝叶斯公式</li>
</ul>
<img alt="file:///home/renewjoy/Documents/github/bigdata-fortune-telling/01_bayes/./bayes.png" src="file:///home/renewjoy/Documents/github/bigdata-fortune-telling/01_bayes/./bayes.png" />
<ul>
<li><dl class="first docutils">
<dt>Paul Graham</dt>
<dd><p class="first last">这种过滤器还具有自我学习的功能，会根据新收到的邮件，不断调整。收到的垃圾邮件越多，它的准确率就越高</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>分词技术</dt>
<dd><ol class="first last arabic simple">
<li>中文分词</li>
<li>特定的url分词</li>
</ol>
</dd>
</dl>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="naive_bayes.rst">naive_bayes.rst</a>
            </aside>
            
            <aside class="page_number">
              2/12
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: naive_bayes.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>几个概率</h1></header>
            
            
            <section><ul>
<li><dl class="first docutils">
<dt>先验概率</dt>
<dd><p class="first last">在没有任何前提下， 事件A发生的概率</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>条件概率</dt>
<dd><p class="first last">在条件A发生前提下， 事件A的概率</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>联合概率</dt>
<dd><p class="first">在多个事件发生的情况下，另一个事件发生概率有多大。</p>
<p class="last">比如，已知W1和W2是两个不同的词语，它们都出现在某封电子邮件之中，那么这封邮件是垃圾邮件的概率，就是联合概率。</p>
</dd>
</dl>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="naive_bayes.rst">naive_bayes.rst</a>
            </aside>
            
            <aside class="page_number">
              3/12
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: naive_bayes.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>两大算法</h1></header>
            
            
            <section><ul>
<li><p class="first">分类</p>
<blockquote>
<p>把特征非常明显的东西分成几类
代表算法：bayes
应用：垃圾邮件过滤，攻击识别</p>
</blockquote>
</li>
<li><p class="first">聚类</p>
<blockquote>
<p>把特征非常相似的东西分聚合在一起
代表算法：kmeans
应用： 明星三维身材聚类</p>
</blockquote>
</li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="naive_bayes.rst">naive_bayes.rst</a>
            </aside>
            
            <aside class="page_number">
              4/12
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: naive_bayes.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>数据结构</h1></header>
            
            
            <section><pre><span class="p">{</span>
        <span class="s">&quot;_id&quot;</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s">&quot;52aa80ad98e86672bad74173&quot;</span><span class="p">),</span>
        <span class="s">&quot;attack_info&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;count&quot;</span> <span class="p">:</span> <span class="mi">132</span><span class="p">,</span>
        <span class="s">&quot;prob&quot;</span> <span class="p">:</span> <span class="mf">0.003693857562613684</span>
        <span class="p">},</span>
        <span class="s">&quot;access_info&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;count&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">&quot;prob&quot;</span> <span class="p">:</span> <span class="mi">0</span>
        <span class="p">},</span>
        <span class="s">&quot;word&quot;</span> <span class="p">:</span> <span class="s">&quot;t(&quot;</span><span class="p">,</span>
        <span class="s">&quot;prob&quot;</span> <span class="p">:</span> <span class="mf">0.9999</span>
<span class="p">}</span>
</pre>
<p>说明：</p>
<ol class="arabic simple">
<li>单词为t(</li>
<li>这个词被识别和攻击的概率为0.999</li>
<li>在攻击日志中出现次数为132次，概率为0.003693857562613684</li>
<li>在正常日志中出现次数为0次，概率为0</li>
</ol></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="naive_bayes.rst">naive_bayes.rst</a>
            </aside>
            
            <aside class="page_number">
              5/12
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: naive_bayes.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Paul Graham的计算公式假设</h1></header>
            
            
            <section><ol class="arabic simple">
<li>在样本中，如果某个词只出现在垃圾邮件中，它在正常邮件的出现频率是1%，反之亦然。这里Paul Grahm认为有改善的空间。</li>
<li>假定垃圾邮件的&quot;先验概率&quot;为50%。文中的样本也是由4000份垃圾邮件和4000份正常邮件组成。</li>
<li>如果有的词是第一次出现，无法计算P(S|W)，就假定这个值等于0.4。</li>
</ol></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="naive_bayes.rst">naive_bayes.rst</a>
            </aside>
            
            <aside class="page_number">
              6/12
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: naive_bayes.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>概率公式</h1></header>
            
            
            <section><h2>条件概率：</h2>
<pre><span class="n">prob</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&quot;good_prob&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">good_prob</span>
<span class="n">prob</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&quot;bad_prob&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bad_prob</span>
<span class="n">prob</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&quot;prob&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bad_prob</span><span class="o">/</span><span class="p">(</span><span class="n">good_prob</span><span class="o">+</span><span class="n">bad_prob</span><span class="p">)</span>
</pre>


<h2>联合概率：</h2>
<pre><span class="c"># 复合概率公式</span>
<span class="c">#                          P1*P2*P3*...*Pn</span>
<span class="c"># P = -----------------------------------------------------------</span>
<span class="c">#       (P1*P2*P3*...*Pn + (1-P1)*(1-P2)*(1-P3)*...*(1-Pn))</span>

<span class="c"># mutil_prob: P1*P2*P3*...*Pn</span>
<span class="c"># onesub_muti_prob: (1-P1)*(1-P2)*(1-P3)*...*(1-Pn)</span>

<span class="n">mutil_prob</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">onesub_muti_prob</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="n">prob_dict</span><span class="p">[</span><span class="n">w</span><span class="p">][</span><span class="s">&quot;prob&quot;</span><span class="p">]</span>
    <span class="k">print</span> <span class="s">&quot;[</span><span class="si">%s</span><span class="s">] [</span><span class="si">%s</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">prob</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">mutil_prob</span> <span class="o">*=</span> <span class="n">prob</span>
    <span class="n">onesub_muti_prob</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">prob</span><span class="p">)</span>

<span class="n">attack_probability</span> <span class="o">=</span> <span class="n">mutil_prob</span><span class="o">/</span><span class="p">(</span><span class="n">mutil_prob</span> <span class="o">+</span> <span class="n">onesub_muti_prob</span><span class="p">)</span>

<span class="k">return</span> <span class="n">attack_probability</span>
</pre></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="naive_bayes.rst">naive_bayes.rst</a>
            </aside>
            
            <aside class="page_number">
              7/12
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: naive_bayes.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>url分词研究(1)</h1></header>
            
            
            <section><h2>原则</h2>
<ol class="arabic simple">
<li>只按空格进行分割。</li>
<li>最后的多个空格，进行压缩后只需要一个空格。</li>
<li>要实现攻击的目的，必须要使用特殊符号，关键字，函数名。</li>
<li>特殊符号能非常有效的匹配正常请求与攻击请求。</li>
</ol>


<h2>分词技术</h2>
<ol class="arabic simple">
<li>将所有的特殊符号替换为： 空格+特殊符号+空格</li>
<li>将部分符号由1变成2, 这样可以将符号往前面都靠上去</li>
<li>符号集 / ( ) . =</li>
<li>/ 主要代表了路径</li>
<li>( ) 通常是和函数一起</li>
<li>. 按文件名与文件后缀进行侵害</li>
<li>= 变量名，变量值</li>
</ol></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="naive_bayes.rst">naive_bayes.rst</a>
            </aside>
            
            <aside class="page_number">
              8/12
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: naive_bayes.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>url分词研究(2)</h1></header>
            
            
            <section><ol class="arabic simple">
<li>将部分符号只往左靠才有意义<ol class="arabic">
<li>&gt; ,</li>
<li>script&gt; select null,1,3,5,</li>
<li>1&gt;2  # 大于符号要算例外</li>
</ol>
</li>
<li>部分符号只往右靠才有意义<ol class="arabic">
<li>&amp; ? &#64; &lt;</li>
<li>小于符号算例外</li>
<li>&#64;&#64;version ?id=  &amp;cm=  &lt;script</li>
</ol>
</li>
<li>要解决，被同时向右靠和同时向左靠<ol class="arabic">
<li>[Access] [/one.php?id=1&amp;uid=3.php;.jpg]</li>
<li>[Split]  / /one. .php ?id= =1 &amp;uid= =3. .php ;. .jpg</li>
<li>其中的=3.这个分词，3就是被向右靠的=与向左千的.</li>
</ol>
</li>
<li>将有意义的符号组合拼接起来<ol class="arabic">
<li>/<a href="#id12"><span class="problematic" id="id13">**</span></a>/# sql注释   --$# sql注释</li>
<li>/../ # 目录跳转</li>
<li><a class="reference external" href="http://">http://</a> # http网站，远程包含，url跳转</li>
</ol>
</li>
</ol></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="naive_bayes.rst">naive_bayes.rst</a>
            </aside>
            
            <aside class="page_number">
              9/12
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: naive_bayes.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>整个流程</h1></header>
            
            
            <section><ol class="arabic simple">
<li>训练数据</li>
</ol>
<blockquote>
<ol class="arabic simple">
<li>越准备越好</li>
<li>可由人工来构造，也可以由其它的算法得出</li>
<li>这步构建好模型</li>
</ol>
</blockquote>
<ol class="arabic simple" start="2">
<li>测试数据</li>
</ol>
<blockquote>
<ol class="arabic simple">
<li>使用上面的模型来测试，应用于实际</li>
<li>在测试的时候，自学习出现的新词汇，反馈并更新模型</li>
<li>人工干预，修正模型</li>
</ol>
</blockquote></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="naive_bayes.rst">naive_bayes.rst</a>
            </aside>
            
            <aside class="page_number">
              10/12
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: naive_bayes.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>how &amp;&amp; why</h1></header>
            
            
            <section><h2>how</h2>
<ol class="arabic simple">
<li>熟悉整个算法流程，并理解其它中各个细节</li>
<li>构建分类纯净的训练数据</li>
<li>不断研究分词技术（重点），并查看对结果的影响</li>
<li>反复进行最上面三个步骤</li>
</ol>

<h3>why</h3>
<ol class="arabic">
<li><p class="first">如果你的过滤器效果越好，就越不能出现误判，一旦误判，后果就会变得很严重。</p>
<p>类似于: 富人越富，穷人越穷</p>
</li>
<li><p class="first">如果你发现过滤器效果出问题了，有正常的请求被识别成了攻击，那么手动调整，或检查原因</p>
<p>类似于: 布施，法律</p>
</li>
</ol></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="naive_bayes.rst">naive_bayes.rst</a>
            </aside>
            
            <aside class="page_number">
              11/12
            </aside>
          </footer>
        </div>
      </div>
      
      <!-- slide source: naive_bayes.rst -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Thank you!</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>
          <footer>
            
            <aside class="source">
              Source: <a href="naive_bayes.rst">naive_bayes.rst</a>
            </aside>
            
            <aside class="page_number">
              12/12
            </aside>
          </footer>
        </div>
      </div>
      
    </div>
  </div>
  
  <div id="toc" class="sidebar hidden">
    <h2>Table of Contents</h2>
    <table>
      <caption>Table of Contents</caption>
      
      <tr id="toc-row-1">
        <th><a href="#slide1">大数据算命系列（1）</a></th>
        <td><a href="#slide1">1</a></td>
      </tr>
      
      
      <tr id="toc-row-2">
        <th><a href="#slide2">贝叶斯公式</a></th>
        <td><a href="#slide2">2</a></td>
      </tr>
      
      
      <tr id="toc-row-3">
        <th><a href="#slide3">几个概率</a></th>
        <td><a href="#slide3">3</a></td>
      </tr>
      
      
      <tr id="toc-row-4">
        <th><a href="#slide4">两大算法</a></th>
        <td><a href="#slide4">4</a></td>
      </tr>
      
      
      <tr id="toc-row-5">
        <th><a href="#slide5">数据结构</a></th>
        <td><a href="#slide5">5</a></td>
      </tr>
      
      
      <tr id="toc-row-6">
        <th><a href="#slide6">Paul Graham的计算公式假设</a></th>
        <td><a href="#slide6">6</a></td>
      </tr>
      
      
      <tr id="toc-row-7">
        <th><a href="#slide7">概率公式</a></th>
        <td><a href="#slide7">7</a></td>
      </tr>
      
      
      <tr id="toc-row-8">
        <th><a href="#slide8">url分词研究(1)</a></th>
        <td><a href="#slide8">8</a></td>
      </tr>
      
      
      <tr id="toc-row-9">
        <th><a href="#slide9">url分词研究(2)</a></th>
        <td><a href="#slide9">9</a></td>
      </tr>
      
      
      <tr id="toc-row-10">
        <th><a href="#slide10">整个流程</a></th>
        <td><a href="#slide10">10</a></td>
      </tr>
      
      
      <tr id="toc-row-11">
        <th><a href="#slide11">how &amp;&amp; why</a></th>
        <td><a href="#slide11">11</a></td>
      </tr>
      
      
      <tr id="toc-row-12">
        <th><a href="#slide12">Thank you!</a></th>
        <td><a href="#slide12">12</a></td>
      </tr>
      
      
    </table>
  </div>
  
  <div id="help" class="sidebar hidden">
    <h2>Help</h2>
    <table>
      <caption>Help</caption>
      <tr>
        <th>Table of Contents</th>
        <td>t</td>
      </tr>
      <tr>
        <th>Exposé</th>
        <td>ESC</td>
      </tr>
      <tr>
        <th>Full screen slides</th>
        <td>e</td>
      </tr>
      <tr>
        <th>Presenter View</th>
        <td>p</td>
      </tr>
      <tr>
        <th>Source Files</th>
        <td>s</td>
      </tr>
      <tr>
        <th>Slide Numbers</th>
        <td>n</td>
      </tr>
      <tr>
        <th>Toggle screen blanking</th>
        <td>b</td>
      </tr>
      <tr>
        <th>Show/hide slide context</th>
        <td>c</td>
      </tr>
      <tr>
        <th>Notes</th>
        <td>2</td>
      </tr>
      <tr>
        <th>Help</th>
        <td>h</td>
      </tr>
    </table>
  </div>
  <script>main()</script>
</body>
</html>